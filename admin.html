<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uploader do GitHub</title>
</head>

<body>

    <label for="tokenInput" id="tokenLabel">Token dostępu GitHub:</label>
    <input type="text" id="tokenInput" placeholder="Wprowadź token dostępu">
    <button onclick="validateToken()">Login</button>

    <input type="file" id="fileInput" style="display: none;">
    <button onclick="uploadFile()" id="uploadButton" style="display: none;">Prześlij Plik</button>

    <script>
        function validateToken() {
            const tokenLabel = document.getElementById('tokenLabel');
            const tokenInput = document.getElementById('tokenInput');
            const uploadButton = document.getElementById('uploadButton');
            const fileInput = document.getElementById('fileInput');

            const token = tokenInput.value.trim();

            if (!token) {
                alert('Wprowadź token dostępu GitHub.');
                return;
            }

            fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                    },
                })
                .then(response => {
                    if (response.ok) {
                        alert('Poprawny token. Można przesyłać pliki.');

                        // Hide login elements and show file upload elements
                        tokenLabel.style.display = 'none';
                        tokenInput.style.display = 'none';
                        document.querySelector('button').style.display = 'none'; // Hide the Login button
                        uploadButton.style.display = 'inline-block'; // Show the Upload button
                        fileInput.style.display = 'inline-block'; // Show the file input
                    } else {
                        alert('Nieprawidłowy token. Spróbuj ponownie.');
                    }
                })
                .catch(error => {
                    console.error('Błąd podczas walidacji tokenu:', error);
                    alert('Błąd podczas walidacji tokenu. Spróbuj ponownie.');
                });
        }

        function uploadFile() {
            const tokenInput = document.getElementById('tokenInput');
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            const token = tokenInput.value.trim();

            if (!token) {
                alert('Wprowadź token dostępu GitHub.');
                return;
            }

            const repoOwner = 'paprotk';
            const repoName = 'obiad';

            const currentDate = new Date();
            const year = String(currentDate.getFullYear()).slice(-2);
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            const formattedDate = `${year}${month}${day}`;

            const fileExtension = getFileExtension(file.name);
            const newFileName = `${formattedDate}.${fileExtension}`;

            const uploadUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${newFileName}`;

            const reader = new FileReader();
            reader.onload = function (event) {
                const content = event.target.result;

                fetch(uploadUrl, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: 'Dodano nowy plik',
                            content: btoa(content),
                        }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Plik przesłany pomyślnie:', data);
                    })
                    .catch(error => {
                        console.error('Błąd podczas przesyłania pliku:', error);
                    });
            };

            reader.readAsBinaryString(file);
        }

        function getFileExtension(fileName) {
            return fileName.split('.').pop().toLowerCase();
        }
    </script>

</body>

</html>
